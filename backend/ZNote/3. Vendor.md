# <span style="color:rgb(136, 236, 90) ; "> 1.) Vendor Model </span>

## <span style="color:rgb(236, 90, 212) ; "> 1.1) Vendor Model Schema </span>

Inside <a>model</a> folder create <a>vendor.model.js</a> file and create user model as follows

```js
import mongoose from "mongoose";
import bcrypt from "bcryptjs";

const vendorSchema = new mongoose.Schema(
  {
    name: {
      type: String,
      required: [true, "Vendor name is required"],
      trim: true,
    },
    email: {
      type: String,
      required: [true, "Vendor email is required"],
      unique: true,
      match: [
        /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,
        "Please add a valid email",
      ],
    },
    password: {
      type: String,
      required: [true, "Vendor password is required"],
      minlength: [6, "Password must be at least 6 characters long"],
      select: false, // Ensures password is not returned in queries
    },

    phone: {
      type: String,
      required: [true, "Phone number is required"],
      match: [/^\d{10,15}$/, "Please add a valid phone number"], // Supports 10-15 digit numbers
    },
    address: {
      street: { type: String, required: true },
      city: { type: String, required: true },
      state: { type: String, required: true },
      country: { type: String, required: true },
      zipCode: { type: String, required: true },
    },
    storeName: {
      type: String,
      required: [true, "Store name is required"],
      unique: true,
    },
    storeDescription: {
      type: String,
      default: null,
      maxlength: [500, "Store description cannot exceed 500 characters"],
    },
    storeAvatar: {
      public_id: {
        type: String,
        default: null,
      },
      url: {
        type: String,
        default: null,
      },
    },
    storeImage: {
      public_id: {
        type: String,
        default: null,
      },
      url: {
        type: String,
        default: null,
      },
    },
    bankDetails: {
      accountHolderName: { type: String, required: true },
      bankName: { type: String, required: true },
      accountNumber: { type: String, required: true },
      ifscCode: { type: String, required: true },
    },
    totalProducts: {
      type: Number,
      default: 0,
    },
    totalRevenue: {
      type: Number,
      default: 0,
    },
    isActive: {
      type: Boolean,
      default: true,
    },
    isVerified: {
      type: Boolean,
      default: false, // Vendor should be verified by admin
    },
    isEmailVerified: {
      type: Boolean,
      default: false, // Vendor should be verified their email
    },
    ratings: {
      average: {
        type: Number,
        default: 0,
        min: [0, "Rating cannot be less than 0"],
        max: [5, "Rating cannot exceed 5"],
      },
      totalReviews: {
        type: Number,
        default: 0,
      },
    },
    socialLinks: {
      facebook: { type: String, default: null },
      twitter: { type: String, default: null },
      instagram: { type: String, default: null },
    },
    createdAt: {
      type: Date,
      default: Date.now,
    },
    updatedAt: {
      type: Date,
      default: Date.now,
    },
    resetPasswordToken: String,
    resetPasswordTime: Date,
  },
  {
    timestamps: true, // Automatically manages createdAt and updatedAt fields
  }
);

// Middleware to hash password before saving the vendor
vendorSchema.pre("save", async function (next) {
  // Only hash the password if it's new or being modified
  if (!this.isModified("password")) {
    return next();
  }

  // Generate a salt and hash the password
  const salt = await bcrypt.genSalt(12);
  this.password = await bcrypt.hash(this.password, salt);

  next();
});

//Compare the password which is stored in mongoDB and password entered by Vendor
vendorSchema.methods.comparePassword = async function (enteredPassword) {
  return await bcrypt.compare(enteredPassword, this.password);
};

export default mongoose.model("Vendor", vendorSchema);
```

# <span style="color:rgb(136, 236, 90) ; "> 2.) Vendor Registration </span>

## <span style="color:rgb(236, 90, 212) ; "> 2.1) Vendor Registration Requirements </span>

1. Get name, email, password, phone,address,storeName, storeDescription, bankDetails,from req.body
2. Check for required fields
3. Check if vendor already exists
4. Check if store name already exists
5. If store name already exists, return error
6. Create new vendor
7. After user created in DB, send activation link to user email
8. send activation code to user email
9. Send response to vendor

## <span style="color:rgb(236, 90, 212) ; "> 2.2) Vendor Registration Code </span>

Inside <a>controllers </a> folder create <a>vendor.controller.js</a> file. In this file write ✍️ the following code.

```js
import Vendor from "../model/vendor.model.js";
import ErrorHandler from "../utils/errorHandler.js";
import asyncErrorHandler from "../middlewares/catchAsyncErrors.js";
import { createVerifyEmailToken } from "../utils/generateTokens.js";
import sendEmail from "../utils/sendEmail.js";

// @desc    Register Vendor
// @route   POST /api/v1/vendor/register
// @access  Public
export const registerVendor = asyncErrorHandler(async (req, res, next) => {
  const {
    name,
    email,
    password,
    phone,
    address,
    storeName,
    storeDescription,
    bankDetails,
  } = req.body;

  console.log(req.body);

  // Check for required fields
  if (!name || !email || !password || !phone || !address || !storeName) {
    return next(new ErrorHandler("All required fields must be filled", 400));
  }

  // Check if vendor already exists
  const existingVendor = await Vendor.findOne({ email });
  if (existingVendor) {
    return next(new ErrorHandler("Vendor with this email already exists", 400));
  }

  //Check if store name already exists
  const existingStore = await Vendor.findOne({ storeName });

  //If store name already exists, return error
  if (existingStore) {
    return next(new ErrorHandler("Store name is already taken", 400));
  }

  // Create new vendor
  const vendor = await Vendor.create({
    name,
    email,
    password,
    phone,
    address,
    storeName,
    storeDescription,
    bankDetails,
  });

  //After user created  in DB,  send activation link to user email
  const { token } = createVerifyEmailToken(vendor._id);
  const activationLink = `${process.env.CLIENT_URL}/api/v1/vendor/verify_email/${token}`;
  const message = activationLink;
  const ejsUrl = `vendor.ejs`;

  //send activation code to user email
  try {
    await sendEmail({
      email: vendor.email,
      subject: "Verify your Email",
      message,
      name: vendor.name,
      ejsUrl: ejsUrl,
    });

    //Send response to vendor
    res.status(201).json({
      success: true,
      message: `Please check your email ${vendor.email} to Verify your email!`,
      token,
    });
  } catch (error) {
    return next(new ErrorHandler(error.message, 400));
  }
});
```

## <span style="color:rgb(236, 90, 212) ; "> 2.3) Generate Token to verify Vendor Email </span>

Inside <a>utils </a> folder in <a>generateToken.js</a> file. In this file write ✍️ the following code.

```js
import jwt from "jsonwebtoken";
import "dotenv/config.js";

// Accessing environment variables
const accessTokenExpiration = process.env.ACCESS_TOKEN_EXPIRATION || "15m"; // Fallback to 15 minutes
const refreshTokenExpiration = process.env.REFRESH_TOKEN_EXPIRATION || "30d"; // Fallback to 30 days

//create Activation Token for user email verify by code
export const createActivationToken = (id) => {
  //Generate random 4 digit number
  const ActivationCode = Math.floor(1000 + Math.random() * 9000).toString();

  //Sign the Activation Code with jwt
  const token = jwt.sign(
    {
      id,
      ActivationCode,
    },
    process.env.ACTIVATION_SECRET,
    {
      expiresIn: process.env.JWT_ACTIVATION_EXPIRES,
    }
  );

  return { token, ActivationCode };
};

//create Activation Token for vendor email verify by link
export const createVerifyEmailToken = (id) => {
  //Sign the Activation Code with jwt
  const token = jwt.sign(
    {
      id,
    },
    process.env.VENDOR_ACTIVATION_SECRET,
    {
      expiresIn: process.env.JWT_VENDOR_ACTIVATION_EXPIRES,
    }
  );

  return { token };
};

// Generating Access Token
export const generateAccessToken = (userId) => {
  return jwt.sign({ id: userId }, process.env.ACCESS_TOKEN_SECRET, {
    expiresIn: `${accessTokenExpiration}m`,
  });
};

// Generating Refresh Token
export const generateRefreshToken = (userId) => {
  return jwt.sign({ id: userId }, process.env.REFRESH_TOKEN_SECRET, {
    expiresIn: refreshTokenExpiration,
  });
};
```

## <span style="color:rgb(236, 90, 212) ; "> 2.4) Vendor Registration Route </span>

Inside <a>routes </a> folder create <a>vendor.route.js</a> file. In this file write ✍️ the following code.

```js
import express from "express";
import { registerVendor } from "../controllers/vendor.controller.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

export default vendorRouter;
```

## <span style="color:rgb(236, 90, 212) ; "> 2.5) In app.js Create Vendor Route Middleware </span>

```js
//module imports
import express from "express";
import cookieParser from "cookie-parser";
import cors from "cors";

//local imports
import "dotenv/config.js";
import ErrorHandlerMiddleware from "./middlewares/error.js";
import userRouter from "./routes/user.route.js";
import vendorRouter from "./routes/vendor.route.js";

export const app = express();
const { ORIGIN } = process.env;

app.use(express.json({ limit: "50mb" }));
app.use(cookieParser());
app.use(express.urlencoded({ extended: true }));

app.use(
  cors({
    origin: ORIGIN,
    credentials: true,
  })
);

//passing bodyParser middleware
app.use(express.json({ limit: "50mb" }));

//cookie parser middleware
app.use(cookieParser());

//cors middleware
app.use(
  cors({
    origin: ORIGIN,
  })
);

//routes
app.use("/api/v1/user", userRouter);
app.use("/api/v1/vendor", vendorRouter);

//testing route
app.get("/test", (req, res, next) => {
  return res.status(200).json({
    success: true,
    message: "Test API is Working",
  });
});

//all Unknown Routes
app.all("*", (req, res, next) => {
  const err = new Error(`Route ${req.originalUrl} not found`);
  err.statusCode = 404;
  next(err);
});

// it's for ErrorHandling
app.use(ErrorHandlerMiddleware);
```

# <span style="color:rgb(136, 236, 90) ; "> 3.)Verify Vendor Email </span>

## <span style="color:rgb(236, 90, 212) ; "> 3.1)Verify Vendor Email Requirements </span>

1. Get token from params
2. Verify the token
3. If the vendor not exists, then return error
4. Find the vendor by ID from the decoded token
5. If the vendor not exists, then return error
6. Check if the vendor is already verified
7. Update the vendor's email verification status
8. Send response to the vendor

## <span style="color:rgb(236, 90, 212) ; "> 3.2)Verify Vendor Email Code </span>

```js
// @desc    Verify  Vendor Email
// @route   POST /api/v1/vendor/verify_email/:token
// @access  Public
export const verifyVendorEmail = asyncErrorHandler(async (req, res, next) => {
  // Get token from params
  const { token } = req.params;

  // Verify the token
  const decoded = jwt.verify(token, process.env.VENDOR_ACTIVATION_SECRET);

  //  if the vendor not exists, then return error
  if (!decoded) {
    return next(new ErrorHandler("Invalid activation token", 400));
  }
  // Find the vendor by ID from the decoded token
  const vendor = await Vendor.findById(decoded.id);

  //  If the vendor not exists, then return error
  if (!vendor) {
    return next(new ErrorHandler("Invalid activation token", 400));
  }

  // Check if the vendor is already verified
  if (vendor.isEmailVerified) {
    return next(new ErrorHandler("Email is already verified", 400));
  }

  // Update the vendor's email verification status
  vendor.isEmailVerified = true;
  await vendor.save();

  // Send response to the vendor
  res.status(200).json({
    success: true,
    message: "Email verified successfully. Your account is now active.",
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 3.3)Verify Vendor Email Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
} from "../controllers/vendor.controller.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 4.)Activate Vendor </span>

## <span style="color:rgb(236, 90, 212) ; "> 4.1)Activate Vendor Requirements </span>

1. Find the vendor by ID
2. If vendor not found, throw error to client
3. If isVerified field is true, send message already activated to client
4. Update the isVerified field to true
5. Finally send successfully message to client

## <span style="color:rgb(236, 90, 212) ; "> 4.2)Activate Vendor Code </span>

```js
// @desc    Activate Vendor by Admin
// @route   PATCH /api/v1/vendor/activate/:id
// @access  Admin
export const activateVendor = asyncErrorHandler(async (req, res, next) => {
  const { id } = req.params;

  // Find the vendor by ID
  const vendor = await Vendor.findById(id);

  //If vendor not found, throw error to client
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  //If  isVerified field is true, send message already activated to client
  if (vendor.isVerified) {
    return res.status(400).json({
      success: false,
      message: "Vendor is already verified.",
    });
  }

  // Update the isVerified field to true
  vendor.isVerified = true;
  await vendor.save();

  //Finally send successfully message to client
  res.status(200).json({
    success: true,
    message: "Vendor has been successfully verified.",
    data: {
      id: vendor._id,
      name: vendor.name,
      email: vendor.email,
      isVerified: vendor.isVerified,
    },
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 4.3)Activate Vendor Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
} from "../middlewares/authMiddleware.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 5.)Login Vendor </span>

## <span style="color:rgb(236, 90, 212) ; "> 5.1)Login Vendor Requirements </span>

1. Get email and password from req.body
2. Validate email and password
3. Find vendor by email
4. If vendor not found, throw error to client
5. Check if email is verified or not, if not verified, send verification link to user
6. Check if the vendor is verified by admin\
7. Check if the password matches
8. If password does not match, return error
9. import methods to generate access Token and refresh token

## <span style="color:rgb(236, 90, 212) ; "> 5.2)Login Vendor Code </span>

```js
// @desc    Login Vendor
// @route   POST /api/v1/vendor/login
// @access  Public
export const loginVendor = asyncErrorHandler(async (req, res, next) => {
  //Get email and password from req.body
  const { email, password } = req.body;

  // Validate email and password
  if (!email || !password) {
    return next(new ErrorHandler("Please provide email and password", 400));
  }

  // Find vendor by email
  const vendor = await Vendor.findOne({ email }).select("+password");

  //If vendor not found, throw error to client
  if (!vendor) {
    return next(new ErrorHandler("Invalid email or password", 401));
  }

  // Check if email is verified
  if (!vendor.isEmailVerified) {
    //After user created  in DB,  send activation link to user email
    const { token } = createVerifyEmailToken(vendor._id);
    const activationLink = `${process.env.CLIENT_URL}/api/v1/vendor/verify_email/${token}`;
    const message = activationLink;
    const ejsUrl = `vendor.ejs`;

    //send activation code to user email
    try {
      await sendEmail({
        email: vendor.email,
        subject: "Verify your Email",
        message,
        name: vendor.name,
        ejsUrl: ejsUrl,
      });

      //Send response to vendor
      res.status(201).json({
        success: true,
        message: `Please check your email ${vendor.email} to Verify your email!`,
        token,
      });
    } catch (error) {
      return next(new ErrorHandler(error.message, 400));
    }
  }

  // Check if the vendor is verified by admin
  if (!vendor.isVerified) {
    return next(
      new ErrorHandler(
        "Your account has not been verified by an admin yet.",
        403
      )
    );
  }

  // Check if the password matches
  const isPasswordMatch = await vendor.comparePassword(password);

  // If password does not match, return error
  if (!isPasswordMatch) {
    return next(new ErrorHandler("Invalid email or password", 401));
  }

  //import methods to generate access Token and refresh token
  sendTokensAsCookiesForVendor(vendor._id, 200, res);
});
```

## <span style="color:rgb(236, 90, 212) ; "> 5.2)Login Vendor Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
} from "../middlewares/authMiddleware.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 6.)Logout Vendor </span>

## <span style="color:rgb(236, 90, 212) ; "> 6.1)Logout Vendor Requirements </span>

1. Check if the vendor is exist
2. if vendor not exists, then return error
3. Clear the refresh token and access token from cookies
4. Send success message to client

## <span style="color:rgb(236, 90, 212) ; "> 6.2)Logout Vendor Code </span>

```js
// @desc    Logout Vendor
// @route   GET /api/v1/vendor/logout
// @access  Private
export const logoutVendor = asyncErrorHandler(async (req, res, next) => {
  // Check if the vendor is exist
  const vendor = await Vendor.findById(req.vendor.id);

  //if vendor not exists, then return error
  if (!vendor) {
    return next(new ErrorHandler("Invalid Credential ", 401));
  }

  // Clear the refresh token and access token from cookies
  res
    .cookie("vendorAccessToken", "", {
      httpOnly: true,
      secure: process.env.NODE_ENV === "production",
      sameSite: "Strict",
      expires: new Date(0), // Set expiry to past date
    })
    .cookie("vendorRefreshToken", "", {
      httpOnly: true,
      secure: process.env.NODE_ENV === "production",
      sameSite: "Strict",
      expires: new Date(0), // Set expiry to past date
    });

  //Send success message to client
  res.status(200).json({
    success: true,
    vendorAccessToken: "",
    message: "Logged out successfully",
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 6.3)Logout Vendor Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 7.)Update Access Token </span>

## <span style="color:rgb(236, 90, 212) ; "> 7.1)Update Access Token Requirements </span>

1. Get vendor refresh token from cookies, every time client send request. the cookie send along with the request.
2. Check whether the refresh token is empty or not
3. Verify the validity of the refresh token
4. If valid, find user by decoded ID from the token
5. Put vendor object on req.vendor for access by middleware
6. import methods to generate access Token and refresh token

## <span style="color:rgb(236, 90, 212) ; "> 7.2)Update Access Token Code </span>

```js
// @desc    Update Access Token
// @route   GET /api/v1/vendor/vendor_refresh_token
// @access  Public
export const updateVendorAccessToken = asyncErrorHandler(
  async (req, res, next) => {
    //Get vendor refresh token from cookies, every time client send request. the cookie send along with the request.
    const refresh_token = req.cookies.vendorRefreshToken;

    // Check whether the refresh token is empty or not
    if (!refresh_token) {
      return next(
        new ErrorHandler("Refresh token not found. Please login again.", 401)
      );
    }
    // Verify the validity of the refresh token
    let decoded;
    try {
      decoded = jwt.verify(refresh_token, process.env.REFRESH_TOKEN_SECRET);
    } catch (err) {
      return next(
        new ErrorHandler("Invalid refresh token. Please login again.", 401)
      );
    }

    // If valid, find user by decoded ID from the token
    const vendor = await Vendor.findById(decoded.id);
    if (!vendor) {
      return next(
        new ErrorHandler("Vendor not found. Please login again.", 404)
      );
    }

    //Put vendor object on req.vendor for access by middleware
    req.vendor = vendor;

    //import methods to generate access Token and refresh token
    sendTokensAsCookiesForVendor(vendor._id, 200, res);
  }
);
```

## <span style="color:rgb(236, 90, 212) ; "> 7.3)Update Access Token Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 8.)Forgot Password </span>

## <span style="color:rgb(236, 90, 212) ; "> 8.1)Forgot Password Requirements </span>

1. Get vendor email from client by req.body
2. Check if email exists
3. If vendor not exist, throw the error
4. If vendor exist, Generate a reset token and hash and set the reset token in the database
5. Hash and set the reset token in the database
6. Create reset URL
7. After create reset token, then send reset link to vendor email

## <span style="color:rgb(236, 90, 212) ; "> 8.2)Forgot Password Code </span>

```js
// @desc    Forgot Password
// @route   POST /api/v1/vendor/forgot_password
// @access  Public
export const forgotPassword = asyncErrorHandler(async (req, res, next) => {
  //Get vendor email from client by req.body
  const { email } = req.body;

  // Check if email exists
  const vendor = await Vendor.findOne({ email });

  //If vendor not exist, throw the error
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found with this email.", 404));
  }

  //If vendor exist, Generate a reset token and hash and set the reset token in the database
  const resetToken = crypto.randomBytes(20).toString("hex");

  // Hash and set the reset token in the database
  vendor.resetPasswordToken = crypto
    .createHash("sha256")
    .update(resetToken)
    .digest("hex");
  vendor.resetPasswordExpire = Date.now() + 10 * 60 * 1000; // Token valid for 10 minutes
  await vendor.save({ validateBeforeSave: false });

  // Create reset URL
  const resetUrl = `${req.protocol}://${req.get(
    "host"
  )}/api/v1/vendor/reset_password/${resetToken}`;

  //After create reset token, then send reset link to vendor email
  try {
    await sendEmail({
      email: vendor.email,
      subject: "Password Reset Request",
      message: resetUrl,
      name: vendor.name,
      ejsUrl: `forgotPassword.ejs`,
    });

    res.status(201).json({
      success: true,
      message: `Password reset email sent to ${vendor.email}`,
    });
  } catch (error) {
    vendor.resetPasswordToken = undefined;
    vendor.resetPasswordExpire = undefined;
    await vendor.save({ validateBeforeSave: false });
    return next(
      new ErrorHandler("Failed to send email. Try again later.", 500)
    );
  }
});
```

## <span style="color:rgb(236, 90, 212) ; "> 8.3)Forgot Password Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 9.)Reset Password </span>

## <span style="color:rgb(236, 90, 212) ; "> 9.1)Reset Password Requirements </span>

1. Get password, confirmPassword from req.body and resetToken from req.params
2. Hash the token to find the vendor
3. Find vendor by the hashed token
4. Check if vendor exists, if not throw error
5. Check if passwords match
6. If everything is ok, Set new password
7. After reset password, send success message to client

## <span style="color:rgb(236, 90, 212) ; "> 9.2)Reset Password Code </span>

```js
// @desc    Reset Password
// @route   POST /api/v1/vendor/reset_password/:resetToken
// @access  Public
export const resetPassword = asyncErrorHandler(async (req, res, next) => {
  //Get password, confirmPassword from req.body and resetToken from req.params
  const { resetToken } = req.params;
  const { password, confirmPassword } = req.body;

  console.log(resetToken);

  // Hash the token to find the vendor
  const resetPasswordToken = crypto
    .createHash("sha256")
    .update(resetToken)
    .digest("hex");

  // Find vendor by the hashed token
  const vendor = await Vendor.findOne({
    resetPasswordToken,
    resetPasswordExpire: { $gt: Date.now() }, // Ensure token is not expired
  });

  // Check if vendor exists, if not throw error
  if (!vendor) {
    return next(
      new ErrorHandler("Invalid or expired password reset token.", 400)
    );
  }

  // Check if passwords match
  if (password !== confirmPassword) {
    return next(new ErrorHandler("Passwords do not match.", 400));
  }

  //If everything is ok, Set new password
  vendor.password = password;
  vendor.resetPasswordToken = undefined;
  vendor.resetPasswordExpire = undefined;
  await vendor.save();

  //After reset password, send success message to client
  res.status(200).json({
    success: true,
    message: "Password reset successfully.",
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 9.3)Reset Password Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 10.)Update Password </span>

## <span style="color:rgb(236, 90, 212) ; "> 10.1)Update Password Requirements </span>

1. Get currentPassword, newPassword, and confirmPassword from the client by req.body
2. Check if all fields are provided
3. Find the user in the database by ID, we get user ID from req.user from isAuthenticated middleware
4. Check if vendor exist, if not throw error to client
5. If vendor exist, Check if current password matches with password in DB
6. If current password is not match, throw error to client
7. If current password matches, Check if new password and confirm password match also
8. If everything is ok, Update the vendor's password
9. Finally send success message to client

## <span style="color:rgb(236, 90, 212) ; "> 10.2)Update Password Code </span>

```js
// @desc    Update Vendor Password
// @route   PUT /api/v1/vendor/update_password
// @access  Private
export const updatePassword = asyncErrorHandler(async (req, res, next) => {
  //Get currentPassword, newPassword, and confirmPassword from the client by req.body
  const { currentPassword, newPassword, confirmPassword } = req.body;

  // Check if all fields are provided
  if (!currentPassword || !newPassword || !confirmPassword) {
    return next(new ErrorHandler("Please provide all required fields", 400));
  }

  // Find the user in the database by ID, we get user ID from req.user from isAuthenticated middleware
  const vendor = await Vendor.findById(req.vendor._id).select("+password");

  //Check if vendor exist, if not throw error to client
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  //If vendor exist, Check if current password matches with password in DB
  const isMatch = await vendor.comparePassword(currentPassword);

  //If current password is not match, throw error to client
  if (!isMatch) {
    return next(new ErrorHandler("Current password is incorrect", 401));
  }

  //If current password matches, Check if new password and confirm password match also
  if (newPassword !== confirmPassword) {
    return next(
      new ErrorHandler("New password and confirm password do not match", 400)
    );
  }

  //If everything is ok, Update the vendor's password
  vendor.password = newPassword;
  await vendor.save();

  //Finally send success message to client
  res.status(200).json({
    success: true,
    message: "Password updated successfully",
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 10.3)Update Password Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 12.)Update Store Avatar </span>

## <span style="color:rgb(236, 90, 212) ; "> 12.1)Update Store Avatar Requirements </span>

1. Get vendor avatar from client by req.file. The new avatar image data (Base64 or image URL)
2. If store Avatar not exist, throw error to client
3. If store Avatar found, then find vendor by ID, we get ID from req.vendor isVendorAuthenticated middleware
4. If vendor not found, throw error to client
5. If vendor exist and store Avatar found, Delete the existing store Avatar from Cloudinary
6. Then Upload the new store avatar to Cloudinary
7. Finally send success message to client

## <span style="color:rgb(236, 90, 212) ; "> 12.2)Update Store Avatar Code </span>

```js
// @desc    Update Store Avatar
// @route   POST /api/v1/vendor/update_store_avatar
// @access  Private
export const updateStoreAvatar = asyncErrorHandler(async (req, res, next) => {
  //Get vendor avatar from client by req.file. The new avatar image data (Base64 or image URL)
  const storeAvatar = req.file?.path;

  //If store Avatar not exist, throw error to client
  if (!storeAvatar) {
    return next(new ErrorHandler("Avatar image is required", 400));
  }

  //If store Avatar found, then find vendor by ID, we get ID from req.vendor isVendorAuthenticated middleware
  const vendor = await Vendor.findById(req.vendor._id);
  //If vendor not found, throw error to client
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  //If vendor exist and store Avatar found, Delete the existing store Avatar from Cloudinary
  if (vendor.storeAvatar.public_id) {
    await cloudinary.uploader.destroy(vendor.storeAvatar.public_id);
  }

  //Then Upload the new store avatar to Cloudinary
  const result = await cloudinary.uploader.upload(storeAvatar, {
    folder: "storeAvatars",
    width: 150,
    crop: "scale",
  });

  // Update also user's store avatar in the database
  vendor.storeAvatar = {
    public_id: result.public_id,
    url: result.secure_url,
  };
  await vendor.save();

  //Finally send success message to client
  res.status(200).json({
    success: true,
    message: "Avatar updated successfully",
    storeAvatar: vendor.storeAvatar,
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 12.3)Update Store Avatar Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import { uploadStoreAvatar } from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 13.)Update Store Image </span>

## <span style="color:rgb(236, 90, 212) ; "> 13.1)Update Store Image Requirements </span>

1. Get vendor store Image from client by req.file. The new avatar image data (Base64 or image URL)
2. If store Image not exist, throw error to client
3. If Store Image found, then find vendor by ID, we get ID from req.vendor isVendorAuthenticated middleware
4. If vendor not found, throw error to client
5. If vendor exist and store Image found, Delete the existing store Image from Cloudinary
6. Then Upload the new Store Image to Cloudinary
7. Update also user's Store Image in the database
8. Finally send success message to client

## <span style="color:rgb(236, 90, 212) ; "> 13.2)Update Store Image Code </span>

```js
// @desc    Update Store Image
// @route   POST /api/v1/vendor/update_store_image
// @access  Private
export const updateStoreImage = asyncErrorHandler(async (req, res, next) => {
  //Get vendor store Image from client by req.file. The new avatar image data (Base64 or image URL)
  const storeImage = req.file?.path;

  //If store Image not exist, throw error to client
  if (!storeImage) {
    return next(new ErrorHandler("Store image is required", 400));
  }

  //If Store Image found, then find vendor by ID, we get ID from req.vendor isVendorAuthenticated middleware
  const vendor = await Vendor.findById(req.vendor._id);

  //If vendor not found, throw error to client
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  //If vendor exist and store Image found, Delete the existing store Image from Cloudinary
  if (vendor.storeImage.public_id) {
    await cloudinary.uploader.destroy(vendor.storeImage.public_id);
  }

  //Then Upload the new avatar to Cloudinary
  const result = await cloudinary.uploader.upload(storeImage, {
    folder: "storeImages",
    width: 150,
    crop: "scale",
  });

  // Update also user's Store Image in the database
  vendor.storeImage = {
    public_id: result.public_id,
    url: result.secure_url,
  };
  await vendor.save();

  //Finally send success message to client
  res.status(200).json({
    success: true,
    message: "Store Image updated successfully",
    storeImage: vendor.storeImage,
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 13.3)Update Store Image Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 14.)Get Vendor Profile </span>

## <span style="color:rgb(236, 90, 212) ; "> 14.1)Get Vendor Profile Requirements </span>

1. Find the authenticated vendor by ID
2. If Vendor not found, throw error to client
3. If Vendor exist, send user data to client

## <span style="color:rgb(236, 90, 212) ; "> 14.2)Get Vendor Profile Code </span>

```js
// @desc    Get Vendor Profile
// @route   GET /api/v1/vendor/me
// @access  Private
export const getVendorInfo = asyncErrorHandler(async (req, res, next) => {
  // Find the authenticated vendor by ID
  const vendor = await Vendor.findById(req.vendor._id).select("-password");

  //If Vendor not found, throw error to client
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  //If Vendor exist, send user data to client
  res.status(200).json({
    success: true,
    vendor,
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 14.3)Get Vendor Profile Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
  getVendorInfo,
  updateVendorInfo,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

// Get Vendor Profile route
vendorRouter.get("/me", isVendorAuthenticated, getVendorInfo);

// Update Vendor profile route
vendorRouter.post("/update_me", isVendorAuthenticated, updateVendorInfo);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 15.)Update Vendor profile </span>

## <span style="color:rgb(236, 90, 212) ; "> 15.1)Update Vendor profile Requirements </span>

1. Get name, email, phone from req.body
2. Validate input
3. Convert email to lowercase
4. Validate email format
5. Validate phone number format if provided
6. Update user information and return the updated user and enable Validation
7. If vendor not found, throw error to client
8. Finally send success message to client

## <span style="color:rgb(236, 90, 212) ; "> 15.2)Update Vendor profile Code </span>

```js
// @desc    Update Vendor Profile
// @route   PATCH /api/v1/vendor/update_profile
// @access  Private
export const updateVendorProfile = asyncErrorHandler(async (req, res, next) => {
  //Get name, email, phone from req.body
  let { name, email, phone, storeName, storeDescription } = req.body;

  // Validate required fields
  if (!name || !email || !phone || !storeName) {
    return next(
      new ErrorHandler("Name, email, phone, and storeName are required!", 400)
    );
  }

  // Validate email format and convert to lowercase
  const emailRegexPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegexPattern.test(email)) {
    return next(new ErrorHandler("Invalid email format", 400));
  }
  email = email.toLowerCase();

  // Validate phone number format
  const phoneNumberRegexPattern = /^[+]?[0-9]{10,15}$/;
  if (!phoneNumberRegexPattern.test(phone)) {
    return next(new ErrorHandler("Invalid phone number format", 400));
  }

  // Find and update vendor details
  const vendor = await Vendor.findByIdAndUpdate(
    req.vendor._id,
    {
      $set: {
        name,
        email,
        phone,
        storeName,
        storeDescription,
      },
    },
    { new: true, runValidators: true }
  );

  // If vendor not found, return error
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  // Send success response
  res.status(200).json({
    success: true,
    message: "Vendor profile updated successfully!",
    vendor,
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 15.3)Update Vendor profile Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
  getVendorInfo,
  updateVendorProfile,
  updateVendorAddress,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

// Get Vendor Profile route
vendorRouter.get("/me", isVendorAuthenticated, getVendorInfo);

// Update Vendor profile route
vendorRouter.patch(
  "/update_profile",
  isVendorAuthenticated,
  updateVendorProfile
);

// Update Vendor address route
vendorRouter.patch(
  "/update_address",
  isVendorAuthenticated,
  updateVendorAddress
);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 16.)Update Vendor Address </span>

## <span style="color:rgb(236, 90, 212) ; "> 16.1)Update Vendor Address Requirements </span>

1. Get street, city, state, country, zipCode from req.body
2. Validate required fields
3. Find and update the vendor's address
4. If vendor not found, return error
5. Send success response

## <span style="color:rgb(236, 90, 212) ; "> 16.1)Update Vendor Address Code </span>

```js
// @desc    Update Vendor Address
// @route   PATCH /api/v1/vendor/update_address
// @access  Private
export const updateVendorAddress = asyncErrorHandler(async (req, res, next) => {
  //Get street, city, state, country, zipCode from req.body
  const { street, city, state, country, zipCode } = req.body;

  // Validate required fields
  if (!street || !city || !country) {
    return next(
      new ErrorHandler("Street, city, and country are required!", 400)
    );
  }

  // Find and update the vendor's address
  const vendor = await Vendor.findByIdAndUpdate(
    req.vendor._id,
    {
      $set: {
        "address.street": street,
        "address.city": city,
        "address.state": state || "",
        "address.country": country,
        "address.zipCode": zipCode || "",
      },
    },
    { new: true, runValidators: true }
  );

  // If vendor not found, return error
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  // Send success response
  res.status(200).json({
    success: true,
    message: "Vendor address updated successfully!",
    vendor,
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 16.1)Update Vendor Address Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
  getVendorInfo,
  updateVendorProfile,
  updateVendorAddress,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

// Get Vendor Profile route
vendorRouter.get("/me", isVendorAuthenticated, getVendorInfo);

// Update Vendor profile route
vendorRouter.patch(
  "/update_profile",
  isVendorAuthenticated,
  updateVendorProfile
);

// Update Vendor address route
vendorRouter.patch(
  "/update_address",
  isVendorAuthenticated,
  updateVendorAddress
);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 17.)Get Vendor By ID for Admin </span>

## <span style="color:rgb(236, 90, 212) ; "> 17.1)Get Vendor By ID for Admin Requirements </span>

1. Get Vendor ID from req.params
2. Find vendor by ID
3. If vendor not found, throw error to Admin
4. Finally send success message to Admin

## <span style="color:rgb(236, 90, 212) ; "> 17.2)Get Vendor By ID for Admin Code </span>

```js
// @desc    Get Vendor By ID for Admin
// @route   GET /api/v1/vendor/admin/get_vendor_info/:vendor_id
// @access  Private
export const getVendorByIdForAdmin = asyncErrorHandler(
  async (req, res, next) => {
    //Get Vendor ID from req.params
    const { vendor_id } = req.params;

    // Find vendor by ID
    const vendor = await Vendor.findById(vendor_id);

    //If vendor not found, throw error to Admin
    if (!vendor) {
      return next(new ErrorHandler("Vendor not found", 404));
    }

    //Finally send success message to Admin
    res.status(200).json({
      success: true,
      vendor,
    });
  }
);
```

## <span style="color:rgb(236, 90, 212) ; "> 17.3)Get Vendor By ID for Admin Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
  getVendorInfo,
  updateVendorProfile,
  updateVendorAddress,
  getVendorByIdForAdmin,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

// Get Vendor Profile route
vendorRouter.get("/me", isVendorAuthenticated, getVendorInfo);

// Update Vendor profile route
vendorRouter.patch(
  "/update_profile",
  isVendorAuthenticated,
  updateVendorProfile
);

// Update Vendor address route
vendorRouter.patch(
  "/update_address",
  isVendorAuthenticated,
  updateVendorAddress
);

// Admin  Vendor Only route
// Get  vendor info by admin route
vendorRouter.get(
  "/admin/get_vendor_info/:vendor_id",
  isAuthenticated,
  authorizeRoles("admin"),
  getVendorByIdForAdmin
);
export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 18.)Get all vendors by admin </span>

## <span style="color:rgb(236, 90, 212) ; "> 18.1)Get all vendors by admin Requirements </span>

1. Retrieve all vendors
2. If no vendor found, throw error to Admin
3. Finally send success message to Admin

## <span style="color:rgb(236, 90, 212) ; "> 18.2)Get all vendors by admin Code </span>

```js
// @desc    Get all vendors by admin
// @route   GET /api/v1/vendor/admin /all_vendors
// @access  Private
export const getAllVendorsForAdmin = asyncErrorHandler(
  async (req, res, next) => {
    // Retrieve all vendors
    const vendors = await Vendor.find();

    //If no vendor found, throw error to Admin
    if (!vendors || vendors.length === 0) {
      return next(new ErrorHandler("No vendors found", 404));
    }

    //Finally send success message to Admin
    res.status(200).json({
      success: true,
      count: vendors.length,
      vendors,
    });
  }
);
```

## <span style="color:rgb(236, 90, 212) ; "> 18.3)Get all vendors by admin Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
  getVendorInfo,
  updateVendorProfile,
  updateVendorAddress,
  getVendorByIdForAdmin,
  getAllVendorsForAdmin,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

// Get Vendor Profile route
vendorRouter.get("/me", isVendorAuthenticated, getVendorInfo);

// Update Vendor profile route
vendorRouter.patch(
  "/update_profile",
  isVendorAuthenticated,
  updateVendorProfile
);

// Update Vendor address route
vendorRouter.patch(
  "/update_address",
  isVendorAuthenticated,
  updateVendorAddress
);

// Admin  Vendor Only route
// Get  vendor info by admin route
vendorRouter.get(
  "/admin/get_vendor_info/:vendor_id",
  isAuthenticated,
  authorizeRoles("admin"),
  getVendorByIdForAdmin
);

// Get  vendor info by admin route
vendorRouter.get(
  "/admin/all_vendors",
  isAuthenticated,
  authorizeRoles("admin"),
  getAllVendorsForAdmin
);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 19.)Delete Vendor By ID for Admin </span>

## <span style="color:rgb(236, 90, 212) ; "> 19.1)Delete Vendor By ID for Admin Requirements </span>

## <span style="color:rgb(236, 90, 212) ; "> 19.2)Delete Vendor By ID for Admin Code </span>

```js
// @desc    Delete Vendor By ID for Admin
// @route   DELETE /api/v1/vendor/admin/delete_vendor_info/:vendor_id
// @access  Private
export const deleteVendorByIdForAdmin = asyncErrorHandler(
  async (req, res, next) => {
    //Get ID from req.params
    const { vendor_id } = req.params;

    // Find vendor by ID
    const vendor = await Vendor.findById(vendor_id);

    //If user not found, throw error to Admin
    if (!vendor) {
      return next(new ErrorHandler("Vendor not found", 404));
    }

    // Delete vendor
    await vendor.deleteOne();

    //Finally send success message to Admin
    res.status(200).json({
      success: true,
      message: "Vendor deleted successfully",
    });
  }
);
```

## <span style="color:rgb(236, 90, 212) ; "> 19.3)Delete Vendor By ID for Admin Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
  getVendorInfo,
  updateVendorProfile,
  updateVendorAddress,
  deleteVendorAccount,
  getVendorByIdForAdmin,
  getAllVendorsForAdmin,
  deleteVendorByIdForAdmin,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

// Get Vendor Profile route
vendorRouter.get("/me", isVendorAuthenticated, getVendorInfo);

// Update Vendor profile route
vendorRouter.patch(
  "/update_profile",
  isVendorAuthenticated,
  updateVendorProfile
);

// Update Vendor address route
vendorRouter.patch(
  "/update_address",
  isVendorAuthenticated,
  updateVendorAddress
);

// Delete  vendor account route
vendorRouter.delete(
  "/delete_account",
  isVendorAuthenticated,
  deleteVendorAccount
);

// Admin  Vendor Only route
// Get  vendor info by admin route
vendorRouter.get(
  "/admin/get_vendor_info/:vendor_id",
  isAuthenticated,
  authorizeRoles("admin"),
  getVendorByIdForAdmin
);

// Get all vendors info by admin route
vendorRouter.get(
  "/admin/all_vendors",
  isAuthenticated,
  authorizeRoles("admin"),
  getAllVendorsForAdmin
);

// Delete  vendor by admin route
vendorRouter.delete(
  "/admin/delete_vendor_info/:vendor_id",
  isAuthenticated,
  authorizeRoles("admin"),
  deleteVendorByIdForAdmin
);

export default vendorRouter;
```

# <span style="color:rgb(136, 236, 90) ; "> 20.)Delete Vendor Account </span>

## <span style="color:rgb(236, 90, 212) ; "> 20.1)Delete Vendor Account Requirements </span>

## <span style="color:rgb(236, 90, 212) ; "> 20.2)Delete Vendor Account Code </span>

```js
// @desc    Delete Vendor Account
// @route   DELETE /api/v1/vendor/delete_account
// @access  Private
export const deleteVendorAccount = asyncErrorHandler(async (req, res, next) => {
  const vendorId = req.vendor._id;

  // Find and delete vendor
  const vendor = await Vendor.findByIdAndDelete(vendorId);

  // If vendor not found, return error
  if (!vendor) {
    return next(new ErrorHandler("Vendor not found", 404));
  }

  // Send success response
  res.status(200).json({
    success: true,
    message: "Your account has been deleted successfully!",
  });
});
```

## <span style="color:rgb(236, 90, 212) ; "> 20.3)Delete Vendor Account Route </span>

```js
import express from "express";
import {
  registerVendor,
  verifyVendorEmail,
  activateVendor,
  loginVendor,
  logoutVendor,
  updateVendorAccessToken,
  forgotPassword,
  resetPassword,
  updatePassword,
  updateStoreAvatar,
  updateStoreImage,
  getVendorInfo,
  updateVendorProfile,
  updateVendorAddress,
  deleteVendorAccount,
  getVendorByIdForAdmin,
  getAllVendorsForAdmin,
  deleteVendorByIdForAdmin,
} from "../controllers/vendor.controller.js";

import {
  authorizeRoles,
  isAuthenticated,
  isVendorAuthenticated,
} from "../middlewares/authMiddleware.js";

import {
  uploadStoreAvatar,
  uploadStoreImage,
} from "../middlewares/fileUploadMiddleware.js";
const vendorRouter = express.Router();

// Create Vendor route
vendorRouter.post("/register", registerVendor);

// Verify  Vendor Email route
vendorRouter.get("/verify_email/:token", verifyVendorEmail);

// Admin route to activate vendor
vendorRouter.patch(
  "/activate/:id",
  isAuthenticated,
  authorizeRoles("admin"),
  activateVendor
);

// Login Vendor route
vendorRouter.post("/login", loginVendor);

// Logout Vendor route
vendorRouter.get("/logout", isVendorAuthenticated, logoutVendor);

// Login Vendor route
vendorRouter.get("/vendor_refresh_token", updateVendorAccessToken);

//Vendor Forgot Password  route
vendorRouter.post("/forgot_password", forgotPassword);

//Vendor Reset Password  route
vendorRouter.post("/reset_password/:resetToken", resetPassword);

// update Password route
vendorRouter.put("/update_password", isVendorAuthenticated, updatePassword);

// update store Avatar route
vendorRouter.post(
  "/update_store_avatar",
  isVendorAuthenticated,
  uploadStoreAvatar,
  updateStoreAvatar
);

// update store Image route
vendorRouter.post(
  "/update_store_image",
  isVendorAuthenticated,
  uploadStoreImage,
  updateStoreImage
);

// Get Vendor Profile route
vendorRouter.get("/me", isVendorAuthenticated, getVendorInfo);

// Update Vendor profile route
vendorRouter.patch(
  "/update_profile",
  isVendorAuthenticated,
  updateVendorProfile
);

// Update Vendor address route
vendorRouter.patch(
  "/update_address",
  isVendorAuthenticated,
  updateVendorAddress
);

// Delete  vendor account route
vendorRouter.delete(
  "/delete_account",
  isVendorAuthenticated,
  deleteVendorAccount
);

// Admin  Vendor Only route
// Get  vendor info by admin route
vendorRouter.get(
  "/admin/get_vendor_info/:vendor_id",
  isAuthenticated,
  authorizeRoles("admin"),
  getVendorByIdForAdmin
);

// Get all vendors info by admin route
vendorRouter.get(
  "/admin/all_vendors",
  isAuthenticated,
  authorizeRoles("admin"),
  getAllVendorsForAdmin
);

// Delete  vendor by admin route
vendorRouter.delete(
  "/admin/delete_vendor_info/:vendor_id",
  isAuthenticated,
  authorizeRoles("admin"),
  deleteVendorByIdForAdmin
);

export default vendorRouter;
```
